{
  "hash": "40c7168c0af55cd1f5e1dad2a1545b71",
  "result": {
    "engine": "knitr",
    "markdown": "# Perspectives on group comparisons\n\n\n\n\n\n\n\n\n\n\n\n## Chapter preparation\n\nIn this chapter, we need a few different datasets and source files, so we will introduce them as we need them.\n\n### Organising your files and project for the chapter\n\nBefore we can get started, you need to organise your files and project for the chapter, so your working directory is in order.\n\n1. In your folder for statistics and research design `Stats_Research_Design`, create a new folder called `08_group_comparisons`. \n\n2. We are working with a few data sets and source files in this chapter, so please save the following zip file containing all the files you need: [Chapter 07 Files](data/07_files.zip). These are all the same as Chapter 7, so you can copy and paste it from your previous chapter if you already have them saved. Right click the link and select \"save link as\", or clicking the link will save the file to your Downloads. Extra the files and save the two folders (`data` and `code`) in your `08_group_comparisons` folder. All the code in this chapter assumes these two folders with all their files inside are in the same folder as your Quarto document. \n\n3. Create an R Project for `08_group_comparisons` as an existing directory for your chapter folder. This should now be your working directory.\n\n4. Create a new Quarto document and give it a sensible title describing the chapter, such as `08 Perspectives on Group Comparisons`. Save the file in your `08_group_comparisons` folder. \n\nYou are now ready to start working on the chapter! \n\n## Dependencies\n\n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(tibble)\n\n# devtools::install_github(\"debruine/faux\")\nlibrary(faux)\n\nsource(\"code/theme_gar.txt\")\nsource(\"code/Rallfun-v35-light.txt\")\nsource(\"code/summarySE.txt\") # Define summary function\n# Code from: \n# http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/\nlibrary(plyr)\nlibrary(cowplot)\n```\n:::\n\n\n\n\n\n## Example: within x between design\n\nThe example is from a 2016 editorial published in the [European Journal of Neuroscience](https://onlinelibrary.wiley.com/doi/full/10.1111/ejn.13400).\n\n### Load data\n\n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- read.csv(\"data/ejn_data.csv\",header=T)\ndata$participant <- factor(data$participant)\n```\n:::\n\n\n\n\n\n### Bar graph\n\nMaking a bar graph in `ggplot2` is actually harder than making a more informative alternative.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatas <- summarySE(data, measurevar=\"value\", groupvars=c(\"group\",\"condition\"))\n\nbargraph <- ggplot(datas, aes(x=group, y=value, fill=condition)) + \n  theme_linedraw() +\n  geom_bar(position=position_dodge(), stat=\"identity\", colour=\"black\") +\n  geom_errorbar(aes(ymin=value-se, ymax=value+se),\n                width=.2,                    # Width of the error bars\n                position=position_dodge(.9)) +\n  scale_fill_manual(values = c(\"#E69F00\", \"#56B4E9\")) +\ntheme(axis.text.x = element_text(colour=\"grey20\",size=16),\n      axis.text.y = element_text(colour=\"grey20\",size=16),  \n      axis.title.x = element_blank(),\n      axis.title.y = element_blank(),\n      legend.title = element_blank(),\n      legend.text = element_text(colour=\"grey20\",size=16),\n      legend.key = element_rect(colour = \"black\",linewidth=.1),\n      legend.position.inside = c(.15, .90),\n      plot.margin = unit(c(5.5,5.5,5.5,5.5), \"pt\"),\n      plot.title = element_text(colour=\"grey20\",size=20)) +\n      labs(title=\"Mean +/- SEM\") +\n      scale_y_continuous(limits=c(0, 15),breaks=seq(0,15,5)) +\n guides(fill = guide_legend(position = \"inside\"))\n\nbargraph\n```\n\n::: {.cell-output-display}\n![](08-gar-gpcomp_files/figure-html/bar_graph-1.png){width=672}\n:::\n:::\n\n\n\n\n\n### 1D scatterplots = stripcharts of differences \n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvalue <- data$value[data$condition==\"condition2\"]-data$value[data$condition==\"condition1\"]\nparticipant <- data$participant[data$condition==\"condition2\"]\ngroup <- data$group[data$condition==\"condition2\"]\ndiff <- data.frame(participant,group,value)\n\nset.seed(8)\n\ndiffstrip <- ggplot(diff, aes(x=group, y=value, fill=group, colour=group, shape=group)) + theme_linedraw() +\n  geom_abline(intercept = 0, slope = 0) +\n  geom_jitter(position=position_jitter(0.1), size=4, stroke=1, alpha=0.9) +\n  scale_shape_manual(values=c(22,21)) +\n  scale_fill_manual(values = c(\"grey70\", \"grey95\")) +\n  scale_colour_manual(values = c(\"grey5\",\"grey5\")) +\n  theme(legend.position=\"none\",\n        axis.text.x = element_text(colour=\"grey20\",size=16),\n        axis.text.y = element_text(colour=\"grey20\",size=16),  \n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        plot.title = element_text(colour=\"grey20\",size=20),\n        plot.margin = unit(c(5.5,5.5,5.5,5.5), \"pt\")) +\n        # plot.margin = unit(c(150,200,5.5,5.5), \"pt\")\n  labs(title=\"Differences: condition 2 - condition 1\") +\n  scale_y_continuous(limits=c(-2.5, 3.5),breaks=seq(-2,3,1)) \n\ndiffstrip\n```\n\n::: {.cell-output-display}\n![](08-gar-gpcomp_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n\n### Stripchart + linked observations \n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np <- ggplot(data, aes(x=condition, y=value, fill=condition, group=participant,shape=group)) + theme_linedraw() +\n  geom_line(linewidth=1, alpha=1) +\n  geom_point(colour = \"black\", size = 4, stroke = 1) +\n  scale_shape_manual(values=c(22,21)) +\n  scale_fill_manual(values = c(\"#E69F00\", \"#56B4E9\")) +\n  theme(axis.text.x = element_text(colour=\"grey20\",size=16),\n        axis.text.y = element_text(colour=\"grey20\",size=16),  \n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        plot.title = element_text(colour=\"grey20\",size=20),\n        legend.position=\"none\",\n        # plot.margin = unit(c(150,100,5.5,5.5), \"pt\")\n        plot.margin = unit(c(5.5,5.5,5.5,5.5), \"pt\")) +\n        labs(title=\"Paired observations\") +\n  scale_y_continuous(limits=c(0, 20),breaks=seq(0,20,5))\n\n# p\nlinkedstrip <- p + facet_grid(. ~ group) +\n  theme(strip.text.x = element_text(size = 20, colour = \"white\"),\n        strip.background = element_rect(colour=\"darkgrey\", fill=\"darkgrey\"))\n\nlinkedstrip\n```\n\n::: {.cell-output-display}\n![](08-gar-gpcomp_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n\n### Scatterplot of paired observations \n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncondition1 <- data$value[data$condition==\"condition1\"]\ncondition2 <- data$value[data$condition==\"condition2\"]\nparticipant <- data$participant[data$condition==\"condition2\"]\ngroup <- data$group[data$condition==\"condition2\"]\nrdata <- data.frame(participant,group,condition1,condition2)\n\nscatterdiff <- ggplot(rdata, aes(x=condition1, y=condition2, group=group, fill=group, colour=group,shape=group)) + \n  geom_abline(intercept = 0) +\n  geom_point(size=4,stroke=1, alpha = 0.9) +\n  theme_linedraw() +\n  scale_shape_manual(values=c(22,21)) +\n  scale_fill_manual(values = c(\"grey70\", \"grey95\")) +\n  scale_colour_manual(values = c(\"grey5\",\"grey5\")) +\n  guides(colour = guide_legend(position = \"inside\")) +\n  theme(axis.text.x = element_text(colour=\"grey20\",size=16),\n        axis.text.y = element_text(colour=\"grey20\",size=16),  \n        axis.title.x = element_text(colour=\"grey20\",size=18),\n        axis.title.y = element_text(colour=\"grey20\",size=18),\n        legend.key.width = unit(1.5,\"cm\"),\n        legend.text = element_text(colour=\"grey20\",size=16),\n        legend.title = element_blank(),\n        legend.position = c(.15, .85),\n        plot.margin = unit(c(5.5,5.5,5.5,5.5), \"pt\"),\n        plot.title = element_text(colour=\"grey20\",size=20)) +\n  labs(title=\"Paired observations\") +\n  scale_x_continuous(limits=c(6, 16),breaks=seq(6,16,2)) +\n  scale_y_continuous(limits=c(6, 19),breaks=seq(6,19,2))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2\n3.5.0.\nℹ Please use the `legend.position.inside` argument of `theme()` instead.\n```\n\n\n:::\n\n```{.r .cell-code}\nscatterdiff\n```\n\n::: {.cell-output-display}\n![](08-gar-gpcomp_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\n\n## Examples of standard group statistics\n\nStats results as reported in the EJN editorial.\n\n### 2 x 2 ANOVA\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\naov_gp_cond <- aov(value ~ group*condition + Error(participant/condition), data=data)\n\nsummary(aov_gp_cond)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nError: participant\n          Df Sum Sq Mean Sq F value Pr(>F)\ngroup      1    4.4    4.43   0.261  0.615\nResiduals 20  339.6   16.98               \n\nError: participant:condition\n                Df Sum Sq Mean Sq F value  Pr(>F)   \ncondition        1  3.986   3.986   7.509 0.01261 * \ngroup:condition  1  4.430   4.430   8.345 0.00908 **\nResiduals       20 10.617   0.531                   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n\n\n### Group 1 t-test\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- data[data$group==\"group1\" & data$condition==\"condition1\" ,\"value\"]\ny <- data[data$group==\"group1\" & data$condition==\"condition2\" ,\"value\"]\nt.test(x, y, paired=T)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPaired t-test\n\ndata:  x and y\nt = -3.8742, df = 10, p-value = 0.003088\nalternative hypothesis: true mean difference is not equal to 0\n95 percent confidence interval:\n -1.9477091 -0.5253818\nsample estimates:\nmean difference \n      -1.236545 \n```\n\n\n:::\n:::\n\n\n\n\n\n### Group 2 t-test\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- data[data$group==\"group2\" & data$condition==\"condition1\" ,\"value\"]\ny <- data[data$group==\"group2\" & data$condition==\"condition2\" ,\"value\"]\nt.test(x,y,paired=T)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPaired t-test\n\ndata:  x and y\nt = 0.1081, df = 10, p-value = 0.9161\nalternative hypothesis: true mean difference is not equal to 0\n95 percent confidence interval:\n -0.6400830  0.7053557\nsample estimates:\nmean difference \n     0.03263636 \n```\n\n\n:::\n:::\n\n\n\n\n\n### Make final figure combining 4 panels\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(8)\n\nplot_grid(bargraph, diffstrip, linkedstrip, scatterdiff, \n                   labels=c(\"A\", \"B\", \"C\", \"D\"), \n                   ncol = 2, \n                   nrow = 2, \n                   rel_heights = c(1, 1),\n                   label_size = 18,\n                   hjust = -1,\n                   scale=.95)\n\n# ggsave(filename='./figures/ejn_summary_figure.pdf', units = \"cm\", width = 30, height = 30)\n```\n:::\n\n\n\n\n\n## Inferences for all pairwise differences\n\nOne way to illustrate the 2x2 interaction is to plot the distribution of all pairwise differences, between the two independent groups, of the condition differences. Indeed, an interaction is a difference of differences.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ng1diff <- data[data$group==\"group1\" & data$condition==\"condition2\" ,\"value\"] - data[data$group==\"group1\" & data$condition==\"condition1\" ,\"value\"]\n\ng2diff <- data[data$group==\"group2\" & data$condition==\"condition2\" ,\"value\"] - data[data$group==\"group2\" & data$condition==\"condition1\" ,\"value\"]\n\napd <- as.vector(outer(g1diff, g2diff, FUN=\"-\")) # all pairwise differences\ndf <- tibble(x = apd)\n\nggplot(df, aes(x = x)) + \n  theme_gar +\n  geom_density(alpha = 1 , fill = \"grey95\", colour = \"black\") +\n  geom_vline(xintercept = 0, linetype = \"dashed\") + # zero reference line\n  geom_vline(xintercept = median(apd)) + # median difference\n  theme(legend.position=\"none\",\n        axis.text = element_text(size=14),\n        axis.title = element_text(size=16,face=\"bold\"),\n        axis.ticks.y = element_blank(),\n        axis.text.y = element_blank()) +\n  coord_cartesian(xlim = c(-3, 6)) +\n  ylab(\"Density\") +\n  xlab(\"All pairwise differences of condition 2 minus condition 1\") +\n  ggtitle(paste0(\"Median = \", median(apd), \", P(X>Y) = \", round(100*mean(apd>0), digits=1), \"%\"))\n```\n\n::: {.cell-output-display}\n![](08-gar-gpcomp_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n\n\n### More details about inferences on all pairwise differences\n\n#### Compute\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\napd <- as.vector(outer(g1diff, g2diff, FUN=\"-\"))\n```\n:::\n\n\n\n\n\n#### All pairwise differences: implementation\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- 1:5\ny <- 1:5\nouter(x, y, FUN=\"-\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     [,1] [,2] [,3] [,4] [,5]\n[1,]    0   -1   -2   -3   -4\n[2,]    1    0   -1   -2   -3\n[3,]    2    1    0   -1   -2\n[4,]    3    2    1    0   -1\n[5,]    4    3    2    1    0\n```\n\n\n:::\n:::\n\n\n\n\n\n#### Median of all pairwise differences\n\nFor a measure of effect size preserving the original units, we could report the median of all pairwise differences and its percentile bootstrap confidence interval:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nout <- wmwpb(g1diff, g2diff, est=median, alpha=.05, nboot=2000)\n```\n:::\n\n\n\n\n\nMedian of all pairwise differences = 1.2 [0.347, 2.092], *P*=0.003.\n\nThis measure answer the questions: what is the typical difference between two observations selected at random from the two groups?\n\n#### Plot bootstrap distribution\n\nHere we calculate and plot the bootstrap distribution of the medians of all pairwise differences between the two independent groups. The results should be very similar to the ones from the `wmwpb` function we used in the previous chunk.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1)\nnboot <- 2000\naav <- 0.05 # arbitrary alpha value\nn1 <- length(g1diff)\nn2 <- length(g2diff)\n\n# bootstrap sampling independently from each group\nboot.diff <- vector(mode = \"numeric\", length = nboot)\nfor(B in 1:nboot){\n  boot.diff[B] <- median(outer(sample(g1diff, size=n1, replace=TRUE),sample(g2diff, size=n2, replace=TRUE),FUN=\"-\"))  \n}\n\nci <- quantile(boot.diff, probs = c(aav/2, 1-aav/2)) \n\ndf <- as_tibble(with(density(boot.diff),data.frame(x,y)))\n\nggplot(df, aes(x = x, y = y)) + theme_gar +\n  geom_vline(xintercept = median(apd), colour = \"grey\", linewidth = 1) +\n  geom_line(linewidth = 2) +\n  labs(x = \"Bootstrap medians of all pairwise differences\", y = \"Density\") +\n    # confidence interval ----------------------\n  geom_segment(x = ci[1], xend = ci[2],\n               y = 0, yend = 0,\n               lineend = \"round\", size = 3, colour = \"orange\") +\n  annotate(geom = \"label\", x = ci[1]+0.15, y = 0.1*max(df$y), size = 7,\n             colour = \"white\", fill = \"orange\", fontface = \"bold\",\n             label = paste(\"L = \", round(ci[1], digits = 2))) +\n  annotate(geom = \"label\", x = ci[2]-0.15, y = 0.1*max(df$y), size = 7,\n             colour = \"white\", fill = \"orange\", fontface = \"bold\",\n             label = paste(\"U = \", round(ci[2], digits = 2)))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](08-gar-gpcomp_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# ggsave(filename=('./figures/nbx_fig_2gpsbootres.pdf'),width=7,height=5)\n```\n:::\n\n\n\n\n\n#### $P(X>Y)$\n\nGiven two observations selected at random from these two groups, what is the probability that an observation from group 1 will be larger than one in group 2?\n\nUsing the `cid()` function:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nout <- cid(g1diff, g2diff)\nout$summary.dvals[3]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.8181818\n```\n\n\n:::\n:::\n\n\n\n\n\n`cid()` also returns the complementary probability $P(X<Y)$ and the robust ordinal measure of effect size known as Cliff's delta: $d = P(X>Y) - P(X<Y)$.\n\nMake our own function to compute the probability that X is greater than Y:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npxgy <- function(x,y){\n  mean(outer(x,y,FUN=\"-\") > 0)\n}\n```\n:::\n\n\n\n\n\nUse it:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npxgy(g1diff, g2diff)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.8181818\n```\n\n\n:::\n:::\n\n\n\n\n\n#### Confidence interval\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(21)\n\nnboot <- 2000\nb.res <- vector(mode = \"numeric\", length = nboot)\nfor(B in 1:nboot){\n  b.res[B] <- pxgy(sample(g1diff, n1, replace = TRUE),\n                   sample(g2diff, n2, replace = TRUE))\n}\n\nquantile(b.res, probs = c(0.025, 0.975))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     2.5%     97.5% \n0.6198347 0.9752066 \n```\n\n\n:::\n:::\n\n\n\n\n\n#### Plot bootstrap distribution\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiff <- pxgy(g1diff, g2diff) # group difference\nci <- quantile(b.res, probs = c(0.025, 0.975))\nci1 <- ci[1]\nci2 <- ci[2]\n\ndf <- as_tibble(with(density(b.res, to = 1),data.frame(x,y)))\n# in the lecture, the graph I presented was generated by using this line of code:\n# df <- as_tibble(with(density(b.res),data.frame(x,y)))\n# How do the graphs differ?\n# check the help for the density function.\n\nggplot(df, aes(x = x, y = y)) + theme_gar +\n  geom_vline(xintercept = diff, colour = \"grey\", size = 1) +\n  geom_line(size = 2) +\n  scale_x_continuous(breaks = seq(0, 1, 0.1)) +\n  coord_cartesian(xlim = c(0, 1.05)) +\n  labs(x = \"Bootstrap P(X>Y)\", y = \"Density\") +\n    # confidence interval ----------------------\n  geom_segment(x = ci[1], xend = ci[2],\n               y = 0, yend = 0,\n               lineend = \"round\", size = 3, colour = \"orange\") +\n  annotate(geom = \"label\", x = ci1+0.015, y = 0.1*max(df$y), size = 7,\n             colour = \"white\", fill = \"orange\", fontface = \"bold\",\n             label = paste(\"L = \", round(ci1, digits = 2))) +\n  annotate(geom = \"label\", x = ci2-0.015, y = 0.1*max(df$y), size = 7,\n             colour = \"white\", fill = \"orange\", fontface = \"bold\",\n             label = paste(\"U = \", round(ci2, digits = 2))) +\n  theme(axis.text.y = element_blank(),\n        axis.ticks.y = element_blank())\n```\n\n::: {.cell-output-display}\n![](08-gar-gpcomp_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n\n\n\n## Two dependent groups: learning experiment\n\nHere are two vectors of paired scores from a cognitive test in two sessions. We are interested in learning effects between sessions. \n\n### Simulate data from n participants\n\nWe use the `faux` package from Lisa Debruine to do that.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(7)\nn <- 100 # number of participants\n\ndf1 <- rmulti(n = n, \n              dist = c(session1 = \"beta\",\n                       session2 = \"beta\"),\n              params = list(session1 = c(shape1=3, shape2=1),\n                            session2 = c(shape1=5, shape2=1)),\n              r = 0.7)\n\nggplot(df1, aes(x=session1,y=session2)) + theme_gar +\n  geom_abline(intercept = 0, slope = 1) +\n  geom_point() +\n  geom_smooth() +\n  coord_cartesian(xlim = c(0,1), ylim = c(0,1))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](08-gar-gpcomp_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n\n\n\n### Illustrate results\n\n#### Make data frame\n\nReformat data frame.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf2 <- tibble(participant = rep(1:n, 2),\n              score = c(df1$session1, df1$session2),\n              group = factor(rep(c(\"Session 1\", \"Session 2\"), each = n)))\n```\n:::\n\n\n\n\n\n#### Independent stripcharts (1D scatterplots)\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(44) # reproducible jitter\n\nggplot(df2, aes(x = group,\n               y = score,\n               fill = group)) +\ngeom_jitter(alpha = 0.7,\n            shape = 21,\n            size = 4,\n            width = .15) +\n  scale_fill_manual(values=c(\"#E69F00\", \"#56B4E9\")) +\n    theme_linedraw() +\n    theme(legend.position = \"none\") +\n    theme(axis.title.y = element_text(size=16,face=\"bold\"),\n        axis.title.x = element_blank(),\n        axis.text = element_text(size=14)) +\n    ylab(\"Score\") +\n  scale_y_continuous(limits = c(0, 1))\n```\n\n::: {.cell-output-display}\n![](08-gar-gpcomp_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n\n\n\n#### Stripcharts with medians\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(44) # reproducible jitter\n\n# compute medians\nmd1 <- median(df1$session1)\nmd2 <- median(df1$session2)\n\nggplot(df2, aes(x = group,\n               y = score,\n               fill = group)) +\ngeom_jitter(alpha = 0.7,\n            shape = 21,\n            size = 4,\n            width = .15) +\nscale_fill_manual(values=c(\"#E69F00\", \"#56B4E9\")) +\n  theme_linedraw() + \n  theme(legend.position = \"none\") +\n  theme(axis.title.y = element_text(size=16,face=\"bold\"),\n        axis.title.x = element_blank(),\n        axis.text = element_text(size=14)) +\n        ylab(\"Scores\") +\nscale_y_continuous(limits = c(0, 1)) +\n# add median for session 1\ngeom_segment(aes(x = 0.75, y = md1, xend = 1.25, yend = md1), size = 1, colour = \"black\") +\n# add median for session 2\ngeom_segment(aes(x = 1.75, y = md2, xend = 2.25, yend = md2), size = 1, colour = \"black\")\n```\n\n::: {.cell-output-display}\n![](08-gar-gpcomp_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n\n\n\n#### Linked stripcharts\n\nNew illustration in which coloured lines link paired observations.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(44) # reproducible jitter\n\npd <- position_dodge(width = 0.1)\n\nggplot(df2, aes(x=group, y=score, group=participant)) + theme_linedraw() +\n  geom_line(aes(colour=participant),size=1, alpha=.9,\n            position=pd) +\n  scale_colour_viridis_c(option = \"A\") +\n  theme(axis.text = element_text(size=14),\n        axis.title.x = element_blank(),\n        axis.title.y = element_text(size=16,face=\"bold\"),\n        legend.position=\"none\") +\n  scale_y_continuous(limits=c(0, 1)) +\n  ylab(\"Scores\")\n```\n\n::: {.cell-output-display}\n![](08-gar-gpcomp_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\n\n\n\n### 1D scatterplot = stripchart of differences\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(44) # reproducible jitter\n\ndf.diff <- tibble(participant = 1:n,\n                  difference = df1$session2 - df1$session1,\n                  gr = rep(\"gr\", n))\n\nggplot(df.diff, aes(x=gr, y=difference)) + theme_gar +\n  geom_abline(intercept = 0, slope = 0, linetype = 2) + # zero reference line\n  geom_jitter(alpha = 0.7,\n              shape = 21,\n              size = 2,\n              width = .15,\n              colour = \"grey10\",\n              fill = \"grey90\") +\n  theme(legend.position=\"none\",\n        axis.ticks.x = element_line(colour=\"white\"),\n        axis.text.x = element_text(size=14,colour=\"white\"),\n        axis.text.y = element_text(size=14),\n        axis.title.x = element_text(size=16,face=\"bold\",colour=\"white\"),\n        axis.title.y = element_text(size=16,face=\"bold\"),\n        plot.title = element_text(colour=\"black\",size=20),\n        panel.grid.major.x = element_blank(),\n        panel.grid.minor.x = element_blank()) +\n  ylab(\"Differences\") +\n  # scale_y_continuous(limits=c(-0.6, 0.6), breaks=seq(-0.6, 0.6, 0.1)) +\n   stat_summary(fun = median, fun.min = median, fun.max = median,\n                 geom = \"crossbar\", width = 0.5)\n```\n\n::: {.cell-output-display}\n![](08-gar-gpcomp_files/figure-html/unnamed-chunk-26-1.png){width=144}\n:::\n:::\n\n\n\n\n\n#### Scatterplot of paired observations\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(df1, aes(x = session1, y = session2)) + theme_linedraw() +\n  geom_point(alpha = 0.7,\n              shape = 21,\n              size = 4,\n              colour = \"grey10\",\n              fill = \"grey90\") +\n  geom_smooth() +\n  geom_abline(intercept = 0,\n              slope = 1,\n              linetype = \"longdash\") + # slope 1 reference line\n  theme(axis.title = element_text(size=16,face=\"bold\"),\n        axis.text = element_text(size=14)) +\n  xlab(\"Session 1\") +\n  ylab(\"Session 2\") +\n  scale_x_continuous(breaks = seq(0, 1, .1)) +\n  theme(plot.title = element_blank()) +\n  coord_cartesian(xlim = c(0, 1), ylim = c(0, 1))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](08-gar-gpcomp_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n\n\n\n\n## Compare marginals\n\nTreated (wrongly) as two independent groups, is the typical score in session 2 higher than in session 1?\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# percentile bootstrap confidence interval of the difference between\n# medians, treating the groups as independent\npb2gen(df1$session2, df1$session1, alpha=.05, nboot=2000, est=median)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$est.1\n[1] 0.8765588\n\n$est.2\n[1] 0.7925541\n\n$est.dif\n[1] 0.08400476\n\n$ci\n[1] 0.03999068 0.13358857\n\n$p.value\n[1] 0.001\n\n$sq.se\n[1] 0.000605188\n\n$n1\n[1] 100\n\n$n2\n[1] 100\n```\n\n\n:::\n:::\n\n\n\n\n\n## Quantify within participant differences\n\nCan we conclude that, within participants, scores are higher in session 2 relative to session 1?\n\n### Summary statistics\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(df1$session2 - df1$session1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. \n-0.249530 -0.004875  0.077910  0.094901  0.176995  0.465837 \n```\n\n\n:::\n:::\n\n\n\n\n\n### Bootstrap test\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compute confidence interval of the median of the paired differences\nonesampb(df1$session2 - df1$session1, alpha=.05, nboot=2000, est=median)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$ci\n[1] 0.04740512 0.10957389\n\n$n\n[1] 100\n\n$estimate\n[1] 0.07790945\n\n$p.value\n[1] 0\n```\n\n\n:::\n:::\n\n\n\n\n\n#### Plot bootstrap distribution of median pairwise differences\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1)\nnboot <- 2000\naav <- 0.05 # arbitrary alpha value\ndiff <- df1$session2 - df1$session1\nn <- length(diff)\n# bootstrap sampling \nboot.diff <- matrix(sample(diff, size=n*nboot, replace=TRUE), nrow=nboot)\n# compute medians for each bootstrap sample\nboot.diff.md <- apply(boot.diff, 1, median)\n# confidence interval\nci <- quantile(boot.diff.md, probs = c(aav/2, 1-aav/2)) \n# group median difference\ndiff.md <- median(diff)\n\nci1 <- round(ci[1], digits=2)\nci2 <- round(ci[2], digits=2)\n\ndf <- as_tibble(with(density(boot.diff.md),data.frame(x,y)))\n\nggplot(df, aes(x = x, y = y)) + theme_gar +\n  geom_vline(xintercept = diff.md, colour = \"grey\", size = 1) +\n  geom_line(linewidth = 2) +\n  # scale_x_continuous(breaks = seq(-200, 200, 20)) +\n  # coord_cartesian(xlim = c(-130, 0)) +\n  labs(x = \"Bootstrap median of pairwise differences\", y = \"Density\") +\n    # confidence interval ----------------------\n  geom_segment(x = ci[1], xend = ci[2],\n               y = 0, yend = 0,\n               lineend = \"round\", size = 3, colour = \"orange\") +\n  annotate(geom = \"label\", x = ci1, y = 0.1*max(df$y), size = 7,\n             colour = \"white\", fill = \"orange\", fontface = \"bold\",\n             label = paste(\"L = \", round(ci1, digits = 2))) +\n  annotate(geom = \"label\", x = ci2, y = 0.1*max(df$y), size = 7,\n             colour = \"white\", fill = \"orange\", fontface = \"bold\",\n             label = paste(\"U = \", round(ci2, digits = 2)))\n```\n\n::: {.cell-output-display}\n![](08-gar-gpcomp_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n\n\n\n\n### $P(diff > 0)$\n\nIn what proportion of participants is performance better in session 2?\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npdiff <- df1$session2 - df1$session1\nmean(pdiff > 0)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.74\n```\n\n\n:::\n:::\n\n\n\n\n\n### $P(diff > 0)$ + confidence interval\n\nFancy a confidence interval for that interesting and perfectly legitimate quantity? The only thing we need is a function we can plug into `onesampb()`.\n\n#### Define function\n\nProbability that x is larger than zero.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npxlz<- function(x){\n  mean(x > 0)\n}\n```\n:::\n\n\n\n\n\n#### Percentile bootstrap\n\nNote how argument `est` is set to our new quantity defined by function `pxlz`.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nonesampb(pdiff, alpha=.05, nboot=2000, est=pxlz, null.value = 0.5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$ci\n[1] 0.65 0.82\n\n$n\n[1] 100\n\n$estimate\n[1] 0.74\n\n$p.value\n[1] 0\n```\n\n\n:::\n:::\n\n\n\n\n\n## References\n\nRousselet, G. A., Pernet, C. R., & Wilcox, R. R. (2017). Beyond differences in means: Robust graphical methods to compare two groups in neuroscience. European Journal of Neuroscience, 46(2), 1738–1748. https://doi.org/10.1111/ejn.13610\n\n",
    "supporting": [
      "08-gar-gpcomp_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}