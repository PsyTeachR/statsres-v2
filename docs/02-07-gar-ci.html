<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="Materials for the MSc Statistics and Research Design course at the University of Glasgow.">
<title>6&nbsp; Confidence Intervals – Statistics and Research Design</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./02-08-gar-gpcomp.html" rel="next">
<link href="./02-00-graph_robust.html" rel="prev">
<link href="./images/logos/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-6NP3MF25W3', { 'anonymize_ip': true});
</script><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css">
<link rel="stylesheet" href="include/booktem.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/glossary.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./02-00-graph_robust.html">Graphical representations and robust statistics</a></li><li class="breadcrumb-item"><a href="./02-07-gar-ci.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Confidence Intervals</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statistics and Research Design</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./01-00-GLM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General linear model</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-01-lm-continuous.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Regression with one continuous predictor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-02-lm-categorical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Regression with one categorical predictor</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-03-lm-multiple.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Multiple Linear Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-04-screening-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Missing data, outliers, and checking assumptions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-05-glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Generalised Linear Regression</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./02-00-graph_robust.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Graphical representations and robust statistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-07-gar-ci.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Confidence Intervals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-08-gar-gpcomp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Perspectives on group comparisons</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-a-installing-brms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Installing the <code>brms</code> package</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#chapter-preparation" id="toc-chapter-preparation" class="nav-link active" data-scroll-target="#chapter-preparation"><span class="header-section-number">6.1</span> Chapter preparation</a>
  <ul class="collapse">
<li><a href="#organising-your-files-and-project-for-the-chapter" id="toc-organising-your-files-and-project-for-the-chapter" class="nav-link" data-scroll-target="#organising-your-files-and-project-for-the-chapter"><span class="header-section-number">6.1.1</span> Organising your files and project for the chapter</a></li>
  </ul>
</li>
  <li><a href="#dependencies" id="toc-dependencies" class="nav-link" data-scroll-target="#dependencies"><span class="header-section-number">6.2</span> Dependencies</a></li>
  <li><a href="#rand-wilcoxs-code" id="toc-rand-wilcoxs-code" class="nav-link" data-scroll-target="#rand-wilcoxs-code"><span class="header-section-number">6.3</span> Rand Wilcox’s code</a></li>
  <li>
<a href="#p-value-sampling-distribution" id="toc-p-value-sampling-distribution" class="nav-link" data-scroll-target="#p-value-sampling-distribution"><span class="header-section-number">6.4</span> P value sampling distribution</a>
  <ul class="collapse">
<li><a href="#no-effect" id="toc-no-effect" class="nav-link" data-scroll-target="#no-effect"><span class="header-section-number">6.4.1</span> No effect</a></li>
  <li><a href="#effect" id="toc-effect" class="nav-link" data-scroll-target="#effect"><span class="header-section-number">6.4.2</span> Effect</a></li>
  </ul>
</li>
  <li>
<a href="#confidence-intervals-sampling-from-normal-distribution" id="toc-confidence-intervals-sampling-from-normal-distribution" class="nav-link" data-scroll-target="#confidence-intervals-sampling-from-normal-distribution"><span class="header-section-number">6.5</span> Confidence intervals: sampling from normal distribution</a>
  <ul class="collapse">
<li><a href="#experiments---20-confidence-intervals" id="toc-experiments---20-confidence-intervals" class="nav-link" data-scroll-target="#experiments---20-confidence-intervals"><span class="header-section-number">6.5.1</span> 20 experiments - 20 confidence intervals</a></li>
  <li><a href="#experiments---20000-confidence-intervals" id="toc-experiments---20000-confidence-intervals" class="nav-link" data-scroll-target="#experiments---20000-confidence-intervals"><span class="header-section-number">6.5.2</span> 20,000 experiments - 20,000 confidence intervals</a></li>
  </ul>
</li>
  <li>
<a href="#confidence-intervals-sampling-from-lognormal-distribution" id="toc-confidence-intervals-sampling-from-lognormal-distribution" class="nav-link" data-scroll-target="#confidence-intervals-sampling-from-lognormal-distribution"><span class="header-section-number">6.6</span> Confidence intervals: sampling from lognormal distribution</a>
  <ul class="collapse">
<li><a href="#experiments---20-confidence-intervals-1" id="toc-experiments---20-confidence-intervals-1" class="nav-link" data-scroll-target="#experiments---20-confidence-intervals-1"><span class="header-section-number">6.6.1</span> 20 experiments - 20 confidence intervals</a></li>
  <li><a href="#experiments---20000-confidence-intervals-1" id="toc-experiments---20000-confidence-intervals-1" class="nav-link" data-scroll-target="#experiments---20000-confidence-intervals-1"><span class="header-section-number">6.6.2</span> 20,000 experiments - 20,000 confidence intervals</a></li>
  </ul>
</li>
  <li>
<a href="#confidence-interval-coverage-simulation-mean-and-20-trimmed-mean" id="toc-confidence-interval-coverage-simulation-mean-and-20-trimmed-mean" class="nav-link" data-scroll-target="#confidence-interval-coverage-simulation-mean-and-20-trimmed-mean"><span class="header-section-number">6.7</span> Confidence interval coverage simulation: mean and 20% trimmed mean</a>
  <ul class="collapse">
<li><a href="#illustrate-populations" id="toc-illustrate-populations" class="nav-link" data-scroll-target="#illustrate-populations"><span class="header-section-number">6.7.1</span> Illustrate populations</a></li>
  <li><a href="#trimmed-means" id="toc-trimmed-means" class="nav-link" data-scroll-target="#trimmed-means"><span class="header-section-number">6.7.2</span> Trimmed means</a></li>
  </ul>
</li>
  <li><a href="#simulation" id="toc-simulation" class="nav-link" data-scroll-target="#simulation"><span class="header-section-number">6.8</span> Simulation</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./02-00-graph_robust.html">Graphical representations and robust statistics</a></li><li class="breadcrumb-item"><a href="./02-07-gar-ci.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Confidence Intervals</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Confidence Intervals</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="chapter-preparation" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="chapter-preparation">
<span class="header-section-number">6.1</span> Chapter preparation</h2>
<p>In this chapter, we need a few different datasets and source files, so we will introduce them as we need them.</p>
<section id="organising-your-files-and-project-for-the-chapter" class="level3" data-number="6.1.1"><h3 data-number="6.1.1" class="anchored" data-anchor-id="organising-your-files-and-project-for-the-chapter">
<span class="header-section-number">6.1.1</span> Organising your files and project for the chapter</h3>
<p>Before we can get started, you need to organise your files and project for the chapter, so your working directory is in order.</p>
<ol type="1">
<li><p>In your folder for statistics and research design <code>Stats_Research_Design</code>, create a new folder called <code>07_confidence_intervals</code>.</p></li>
<li><p>We are working with a few data sets and source files in this chapter, so please save the following zip file containing all the files you need: <a href="data/07_files.zip">Chapter 07 Files</a>. Right click the link and select “save link as”, or clicking the link will save the file to your Downloads. Extra the files and save the two folders (<code>data</code> and <code>code</code>) in your <code>07_confidence_intervals</code> folder. All the code in this chapter assumes these two folders with all their files inside are in the same folder as your Quarto document.</p></li>
<li><p>Create an R Project for <code>07_confidence_intervals</code> as an existing directory for your chapter folder. This should now be your working directory.</p></li>
<li><p>Create a new Quarto document and give it a sensible title describing the chapter, such as <code>07 Confidence Intervals</code>. Save the file in your <code>07_confidence_intervals</code> folder.</p></li>
</ol>
<p>You are now ready to start working on the chapter!</p>
</section></section><section id="dependencies" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="dependencies">
<span class="header-section-number">6.2</span> Dependencies</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(tibble)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">source</span>(<span class="st">"code/theme_gar.txt"</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">source</span>(<span class="st">"code/Rallfun-v35-light.txt"</span>)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(beepr) <span class="co"># for little auditory rewards :)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="rand-wilcoxs-code" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="rand-wilcoxs-code">
<span class="header-section-number">6.3</span> Rand Wilcox’s code</h2>
<p>When I mention code from Rand Wilcox, it is available in a giant text file (see Wilcox’s <a href="https://dornsife.usc.edu/labs/rwilcox/software/">website</a> for the most recent version of the code). You access the functions by using the <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">source</span>(<span class="st">"code/Rallfun-v35.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For convenience, most of the functions necessary for this course are available in the smaller file <code>Rallfun-v35-light.txt</code>. In this version, I’ve removed the option <code>SEED=TRUE</code>, which allows users to set the random seed inside the function, which means you get the same results every time you use the function. With <code>SEED=FALSE</code>, different random bootstrap samples are returned each time the function is called. It is better practice to set the seed in your R notebook, for reproducibility and transparency. So be careful to use <code>SEED=FALSE</code> when using functions from <code>Rallfun-v35.txt</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">source</span>(<span class="st">"code/Rallfun-v35-light.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In some of the notebooks, I’ve extracted one or a few functions so you can source a smaller file. This prevents your environment from being cluttered with functions you don’t need. Creating a well documented R package is a lot of work, so some statisticians don’t spend the time required. But that means their code is less accessible.</p>
<p>Some of the functions are also available in the <code>WRS2</code> package available on <a href="https://cran.r-project.org/web/packages/WRS2/index.html">CRAN</a>. For correlation analyses, I have created an R package called <a href="https://github.com/GRousselet/bootcorci"><code>bootcorci</code></a>. To quantify how distributions differ using quantile estimation, I have created the <a href="https://github.com/GRousselet/rogme"><code>rogme</code></a> R package.</p>
</section><section id="p-value-sampling-distribution" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="p-value-sampling-distribution">
<span class="header-section-number">6.4</span> P value sampling distribution</h2>
<p>Consider normality only.</p>
<section id="no-effect" class="level3" data-number="6.4.1"><h3 data-number="6.4.1" class="anchored" data-anchor-id="no-effect">
<span class="header-section-number">6.4.1</span> No effect</h3>
<p>How are p values distributed under the null?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">set.seed</span>(<span class="dv">21</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a>alpha.val <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>nsim <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>p.sampdist.h0 <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> nsim)</span>
<span id="cb4-7"><a href="#cb4-7"></a>p.sampdist.h1 <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> nsim)</span>
<span id="cb4-8"><a href="#cb4-8"></a>es <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co"># effect size to add to each sample</span></span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co"># get sampling distribution of t values</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="cf">for</span>(S <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim){</span>
<span id="cb4-12"><a href="#cb4-12"></a>  p.sampdist.h0[S] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(<span class="fu">rnorm</span>(n))<span class="sc">$</span>p.value</span>
<span id="cb4-13"><a href="#cb4-13"></a>  p.sampdist.h1[S] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(<span class="fu">rnorm</span>(n) <span class="sc">+</span> es)<span class="sc">$</span>p.value</span>
<span id="cb4-14"><a href="#cb4-14"></a>}</span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co"># out &lt;- density(p.sampdist.h0)</span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co"># samp.dens &lt;- tibble(x = out$x,</span></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co">#                     y = out$y)</span></span>
<span id="cb4-18"><a href="#cb4-18"></a></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="co"># ggplot(df, aes(x = x, y = y)) + theme_linedraw() +</span></span>
<span id="cb4-20"><a href="#cb4-20"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> p.sampdist.h0)</span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span> <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb4-22"><a href="#cb4-22"></a>  <span class="fu">geom_histogram</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.05</span>), <span class="at">fill=</span><span class="st">"grey90"</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb4-23"><a href="#cb4-23"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb4-24"><a href="#cb4-24"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb4-25"><a href="#cb4-25"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb4-26"><a href="#cb4-26"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">"Distribution of p values under the null"</span>)) <span class="sc">+</span></span>
<span id="cb4-27"><a href="#cb4-27"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"p values"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb4-28"><a href="#cb4-28"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="02-07-gar-ci_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="effect" class="level3" data-number="6.4.2"><h3 data-number="6.4.2" class="anchored" data-anchor-id="effect">
<span class="header-section-number">6.4.2</span> Effect</h3>
<p>Now we look at the distribution of p values when there is a 0.5 effect.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> p.sampdist.h1)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span> <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">geom_histogram</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.05</span>), <span class="at">fill=</span><span class="st">"grey90"</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb5-5"><a href="#cb5-5"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb5-6"><a href="#cb5-6"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">"Distribution of p values when there is an effect"</span>)) <span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"p values"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="02-07-gar-ci_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="confidence-intervals-sampling-from-normal-distribution" class="level2" data-number="6.5"><h2 data-number="6.5" class="anchored" data-anchor-id="confidence-intervals-sampling-from-normal-distribution">
<span class="header-section-number">6.5</span> Confidence intervals: sampling from normal distribution</h2>
<p>We sample from a standard normal population (mean 0 and standard deviation 1).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>pop.m <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># population mean</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>pop.sd <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># population sd</span></span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="fl">0.1</span>)</span>
<span id="cb6-5"><a href="#cb6-5"></a>y <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(x, pop.m, pop.sd)</span>
<span id="cb6-6"><a href="#cb6-6"></a></span>
<span id="cb6-7"><a href="#cb6-7"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> x,</span>
<span id="cb6-8"><a href="#cb6-8"></a>             <span class="at">y =</span> y)</span>
<span id="cb6-9"><a href="#cb6-9"></a></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> pop.m, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb6-14"><a href="#cb6-14"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb6-15"><a href="#cb6-15"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-16"><a href="#cb6-16"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb6-17"><a href="#cb6-17"></a>  <span class="fu">xlab</span>(<span class="st">"Population values"</span>) <span class="sc">+</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb6-19"><a href="#cb6-19"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="02-07-gar-ci_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># ggsave(filename = './figures/nb2_norm_pop.pdf', width = 7, height = 5)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="experiments---20-confidence-intervals" class="level3" data-number="6.5.1"><h3 data-number="6.5.1" class="anchored" data-anchor-id="experiments---20-confidence-intervals">
<span class="header-section-number">6.5.1</span> 20 experiments - 20 confidence intervals</h3>
<p>We perform many experiments, and for each experiment we compute a parametric one-sample confidence interval, which we plot as horizontal lines.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">set.seed</span>(<span class="dv">666</span>) <span class="co"># set seed of random number generator</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>alpha.val <span class="ot">&lt;-</span> .<span class="dv">1</span> <span class="co"># 90% confidence interval</span></span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a>nexp <span class="ot">&lt;-</span> <span class="dv">20</span> <span class="co"># number of experiments</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span> <span class="co"># sample size in each experiment</span></span>
<span id="cb8-6"><a href="#cb8-6"></a></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co">#declare matrices to save results</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>mean.all <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> nexp) <span class="co"># save sample means</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>ci.ttest <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nexp, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="co"># save confidence intervals</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>ci.ttest.in <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> nexp) <span class="co"># save coverage</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>samp.all <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nexp, <span class="at">ncol =</span> n) <span class="co"># save samples</span></span>
<span id="cb8-12"><a href="#cb8-12"></a></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="cf">for</span>(E <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nexp){</span>
<span id="cb8-14"><a href="#cb8-14"></a>  <span class="co"># sample data</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>  samp <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, pop.m, pop.sd) </span>
<span id="cb8-16"><a href="#cb8-16"></a>  mean.all[E] <span class="ot">&lt;-</span> <span class="fu">mean</span>(samp) <span class="co"># save  mean of each sample</span></span>
<span id="cb8-17"><a href="#cb8-17"></a>  samp.all[E,] <span class="ot">&lt;-</span> samp <span class="co"># save sample</span></span>
<span id="cb8-18"><a href="#cb8-18"></a>  ci.ttest[E,] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(samp, <span class="at">conf.level =</span> <span class="dv">1</span><span class="sc">-</span>alpha.val)<span class="sc">$</span>conf.int</span>
<span id="cb8-19"><a href="#cb8-19"></a>  <span class="co"># check if the confidence interval includes the population value</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>  <span class="cf">if</span>(ci.ttest[E,<span class="dv">1</span>] <span class="sc">&gt;</span> pop.m <span class="sc">||</span> ci.ttest[E,<span class="dv">2</span>] <span class="sc">&lt;</span> pop.m){</span>
<span id="cb8-21"><a href="#cb8-21"></a>    ci.ttest.in[E] <span class="ot">&lt;-</span> <span class="dv">0</span>  </span>
<span id="cb8-22"><a href="#cb8-22"></a>  } <span class="cf">else</span>{</span>
<span id="cb8-23"><a href="#cb8-23"></a>    ci.ttest.in[E] <span class="ot">&lt;-</span> <span class="dv">1</span>  </span>
<span id="cb8-24"><a href="#cb8-24"></a>  }</span>
<span id="cb8-25"><a href="#cb8-25"></a>  </span>
<span id="cb8-26"><a href="#cb8-26"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="illustrate-results" class="level4" data-number="6.5.1.1"><h4 data-number="6.5.1.1" class="anchored" data-anchor-id="illustrate-results">
<span class="header-section-number">6.5.1.1</span> Illustrate results</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># confidence intervals</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">as.vector</span>(ci.ttest),</span>
<span id="cb9-3"><a href="#cb9-3"></a>             <span class="at">y =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>nexp,<span class="dv">2</span>),</span>
<span id="cb9-4"><a href="#cb9-4"></a>             <span class="at">gr =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>nexp,<span class="dv">2</span>)),</span>
<span id="cb9-5"><a href="#cb9-5"></a>             <span class="at">inout =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(ci.ttest.in,<span class="dv">2</span>))</span>
<span id="cb9-6"><a href="#cb9-6"></a>)</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co"># sample means</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>df2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> mean.all,</span>
<span id="cb9-10"><a href="#cb9-10"></a>              <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span>nexp,</span>
<span id="cb9-11"><a href="#cb9-11"></a>              <span class="at">inout =</span> <span class="fu">factor</span>(ci.ttest.in))</span>
<span id="cb9-12"><a href="#cb9-12"></a></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co"># samples</span></span>
<span id="cb9-14"><a href="#cb9-14"></a>df3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">as.vector</span>(samp.all),</span>
<span id="cb9-15"><a href="#cb9-15"></a>              <span class="at">y =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>nexp <span class="sc">+</span> <span class="fl">0.15</span>, n)</span>
<span id="cb9-16"><a href="#cb9-16"></a>)</span>
<span id="cb9-17"><a href="#cb9-17"></a></span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb9-19"><a href="#cb9-19"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> gr, <span class="at">colour =</span> inout), <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">lineend =</span> <span class="st">"round"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="co"># CI</span></span>
<span id="cb9-20"><a href="#cb9-20"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df3, <span class="at">size=</span><span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> <span class="co"># samples</span></span>
<span id="cb9-21"><a href="#cb9-21"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df2, <span class="fu">aes</span>(<span class="at">colour =</span> inout), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="co"># sample means</span></span>
<span id="cb9-22"><a href="#cb9-22"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkgrey"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb9-23"><a href="#cb9-23"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> pop.m, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb9-24"><a href="#cb9-24"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Values"</span>, <span class="at">y =</span> <span class="st">"Experiments"</span>) <span class="sc">+</span></span>
<span id="cb9-25"><a href="#cb9-25"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb9-26"><a href="#cb9-26"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb9-27"><a href="#cb9-27"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">minor_breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="02-07-gar-ci_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># ggsave(filename = './figures/nb2_20expt_ttci_norm.pdf', width = 5, height = 7)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="experiments---20000-confidence-intervals" class="level3" data-number="6.5.2"><h3 data-number="6.5.2" class="anchored" data-anchor-id="experiments---20000-confidence-intervals">
<span class="header-section-number">6.5.2</span> 20,000 experiments - 20,000 confidence intervals</h3>
<p>Now we do 20,000 experiments, and check the long term coverage of the confidence intervals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">set.seed</span>(<span class="dv">21</span>) <span class="co"># set seed of random number generator</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>alpha.val <span class="ot">&lt;-</span> .<span class="dv">1</span> <span class="co"># 90% confidence interval</span></span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a>nexp <span class="ot">&lt;-</span> <span class="dv">20000</span> <span class="co"># number of experiments</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span> <span class="co"># sample size in each experiment</span></span>
<span id="cb11-6"><a href="#cb11-6"></a></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co">#declare matrices to save results</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>ci.ttest <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nexp, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb11-9"><a href="#cb11-9"></a>ci.ttest.in <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> nexp)</span>
<span id="cb11-10"><a href="#cb11-10"></a>mean.all <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> nexp)</span>
<span id="cb11-11"><a href="#cb11-11"></a></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="cf">for</span>(E <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nexp){</span>
<span id="cb11-13"><a href="#cb11-13"></a>  <span class="co"># sample data </span></span>
<span id="cb11-14"><a href="#cb11-14"></a>  samp <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, pop.m, pop.sd)</span>
<span id="cb11-15"><a href="#cb11-15"></a>  <span class="co"># mean.all[E] &lt;- mean(samp) # sample means</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>  ci.ttest[E,] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(samp, <span class="at">conf.level =</span> <span class="dv">1</span><span class="sc">-</span>alpha.val)<span class="sc">$</span>conf.int</span>
<span id="cb11-17"><a href="#cb11-17"></a>  <span class="co"># check if the confidence interval includes the population value</span></span>
<span id="cb11-18"><a href="#cb11-18"></a>  <span class="cf">if</span>(ci.ttest[E,<span class="dv">1</span>] <span class="sc">&gt;</span> pop.m <span class="sc">||</span> ci.ttest[E,<span class="dv">2</span>] <span class="sc">&lt;</span> pop.m){</span>
<span id="cb11-19"><a href="#cb11-19"></a>    ci.ttest.in[E] <span class="ot">&lt;-</span> <span class="dv">0</span>  </span>
<span id="cb11-20"><a href="#cb11-20"></a>  } <span class="cf">else</span>{</span>
<span id="cb11-21"><a href="#cb11-21"></a>    ci.ttest.in[E] <span class="ot">&lt;-</span> <span class="dv">1</span>  </span>
<span id="cb11-22"><a href="#cb11-22"></a>  }</span>
<span id="cb11-23"><a href="#cb11-23"></a>  </span>
<span id="cb11-24"><a href="#cb11-24"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Confidence interval coverage = 90.4%.</p>
<section id="illustrate-cis-excluding-population" class="level4" data-number="6.5.2.1"><h4 data-number="6.5.2.1" class="anchored" data-anchor-id="illustrate-cis-excluding-population">
<span class="header-section-number">6.5.2.1</span> Illustrate CIs excluding population</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>ci <span class="ot">&lt;-</span> ci.ttest[ci.ttest.in<span class="sc">==</span><span class="dv">0</span>, ]</span>
<span id="cb12-2"><a href="#cb12-2"></a>todo <span class="ot">&lt;-</span> <span class="fu">sum</span>(ci.ttest.in<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb12-3"><a href="#cb12-3"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">as.vector</span>(ci),</span>
<span id="cb12-4"><a href="#cb12-4"></a>             <span class="at">y =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>todo, <span class="dv">2</span>),</span>
<span id="cb12-5"><a href="#cb12-5"></a>             <span class="at">gr =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>todo,<span class="dv">2</span>))</span>
<span id="cb12-6"><a href="#cb12-6"></a>)</span>
<span id="cb12-7"><a href="#cb12-7"></a></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> gr)) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> pop.m, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Bounds"</span>, <span class="at">y =</span> <span class="st">"Confidence intervals"</span>) <span class="sc">+</span> </span>
<span id="cb12-12"><a href="#cb12-12"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb12-13"><a href="#cb12-13"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="02-07-gar-ci_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># ggsave(filename = './figures/nb2_ttci_norm_expop.pdf')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Proportion of confidence intervals shifted to the <strong>left</strong> of the population value = 4.9%.</p>
<p>Proportion of confidence intervals shifted to the <strong>right</strong> of the population value = 4.7%.</p>
</section></section></section><section id="confidence-intervals-sampling-from-lognormal-distribution" class="level2" data-number="6.6"><h2 data-number="6.6" class="anchored" data-anchor-id="confidence-intervals-sampling-from-lognormal-distribution">
<span class="header-section-number">6.6</span> Confidence intervals: sampling from lognormal distribution</h2>
<p>Now we sample from a lognormal population, which is an example of a skewed distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>logpop.m <span class="ot">&lt;-</span> <span class="fu">exp</span>(pop.m <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span>pop.sd<span class="sc">^</span><span class="dv">2</span>) <span class="co"># population mean</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="co"># mean(rlnorm(20000)) # check that the population value is correct</span></span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">10</span>, <span class="fl">0.01</span>)</span>
<span id="cb14-5"><a href="#cb14-5"></a>y <span class="ot">&lt;-</span> <span class="fu">dlnorm</span>(x, pop.m, pop.sd)</span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> x,</span>
<span id="cb14-8"><a href="#cb14-8"></a>             <span class="at">y =</span> y)</span>
<span id="cb14-9"><a href="#cb14-9"></a></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> logpop.m, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb14-13"><a href="#cb14-13"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb14-14"><a href="#cb14-14"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb14-15"><a href="#cb14-15"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-16"><a href="#cb14-16"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb14-17"><a href="#cb14-17"></a>  <span class="fu">xlab</span>(<span class="st">"Population values"</span>) <span class="sc">+</span></span>
<span id="cb14-18"><a href="#cb14-18"></a>  <span class="fu">ylab</span>(<span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb14-19"><a href="#cb14-19"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="02-07-gar-ci_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># ggsave(filename = './figures/nb2_lnorm_pop.pdf', width = 7, height = 5)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="experiments---20-confidence-intervals-1" class="level3" data-number="6.6.1"><h3 data-number="6.6.1" class="anchored" data-anchor-id="experiments---20-confidence-intervals-1">
<span class="header-section-number">6.6.1</span> 20 experiments - 20 confidence intervals</h3>
<p>We perform many experiments, and for each experiment we compute a confidence interval, which we plot as horizontal lines.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">set.seed</span>(<span class="dv">21</span>) <span class="co"># set seed of random number generator</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>alpha.val <span class="ot">&lt;-</span> .<span class="dv">1</span> <span class="co"># 90% confidence interval</span></span>
<span id="cb16-3"><a href="#cb16-3"></a></span>
<span id="cb16-4"><a href="#cb16-4"></a>nexp <span class="ot">&lt;-</span> <span class="dv">20</span> <span class="co"># number of experiments</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span> <span class="co"># sample size in each experiment</span></span>
<span id="cb16-6"><a href="#cb16-6"></a></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="co">#declare matrices to save results</span></span>
<span id="cb16-8"><a href="#cb16-8"></a>mean.all <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> nexp)</span>
<span id="cb16-9"><a href="#cb16-9"></a>ci.ttest <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nexp, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb16-10"><a href="#cb16-10"></a>ci.ttest.in <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> nexp)</span>
<span id="cb16-11"><a href="#cb16-11"></a>samp.all <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nexp, <span class="at">ncol =</span> n)</span>
<span id="cb16-12"><a href="#cb16-12"></a></span>
<span id="cb16-13"><a href="#cb16-13"></a><span class="cf">for</span>(E <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nexp){</span>
<span id="cb16-14"><a href="#cb16-14"></a>  <span class="co"># sample data + bootstrap + compute mean of each bootstrap sample</span></span>
<span id="cb16-15"><a href="#cb16-15"></a>  samp <span class="ot">&lt;-</span> <span class="fu">rlnorm</span>(n, pop.m, pop.sd)</span>
<span id="cb16-16"><a href="#cb16-16"></a>  samp.all[E,] <span class="ot">&lt;-</span> samp</span>
<span id="cb16-17"><a href="#cb16-17"></a>  mean.all[E] <span class="ot">&lt;-</span> <span class="fu">mean</span>(samp) <span class="co"># sample means</span></span>
<span id="cb16-18"><a href="#cb16-18"></a>  ci.ttest[E,] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(samp, <span class="at">conf.level =</span> <span class="dv">1</span><span class="sc">-</span>alpha.val)<span class="sc">$</span>conf.int</span>
<span id="cb16-19"><a href="#cb16-19"></a>  <span class="co"># check if the confidence interval includes the population value</span></span>
<span id="cb16-20"><a href="#cb16-20"></a>  <span class="cf">if</span>(ci.ttest[E,<span class="dv">1</span>] <span class="sc">&gt;</span> logpop.m <span class="sc">||</span> ci.ttest[E,<span class="dv">2</span>] <span class="sc">&lt;</span> logpop.m){</span>
<span id="cb16-21"><a href="#cb16-21"></a>    ci.ttest.in[E] <span class="ot">&lt;-</span> <span class="dv">0</span>  </span>
<span id="cb16-22"><a href="#cb16-22"></a>  } <span class="cf">else</span>{</span>
<span id="cb16-23"><a href="#cb16-23"></a>    ci.ttest.in[E] <span class="ot">&lt;-</span> <span class="dv">1</span>  </span>
<span id="cb16-24"><a href="#cb16-24"></a>  }</span>
<span id="cb16-25"><a href="#cb16-25"></a>  </span>
<span id="cb16-26"><a href="#cb16-26"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="illustrate-results-1" class="level4" data-number="6.6.1.1"><h4 data-number="6.6.1.1" class="anchored" data-anchor-id="illustrate-results-1">
<span class="header-section-number">6.6.1.1</span> Illustrate results</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># confidence intervals</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">as.vector</span>(ci.ttest),</span>
<span id="cb17-3"><a href="#cb17-3"></a>             <span class="at">y =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>nexp,<span class="dv">2</span>),</span>
<span id="cb17-4"><a href="#cb17-4"></a>             <span class="at">gr =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>nexp,<span class="dv">2</span>)),</span>
<span id="cb17-5"><a href="#cb17-5"></a>             <span class="at">inout =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(ci.ttest.in,<span class="dv">2</span>))</span>
<span id="cb17-6"><a href="#cb17-6"></a>)</span>
<span id="cb17-7"><a href="#cb17-7"></a></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="co"># sample means</span></span>
<span id="cb17-9"><a href="#cb17-9"></a>df2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> mean.all,</span>
<span id="cb17-10"><a href="#cb17-10"></a>              <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span>nexp,</span>
<span id="cb17-11"><a href="#cb17-11"></a>              <span class="at">inout =</span> <span class="fu">factor</span>(ci.ttest.in))</span>
<span id="cb17-12"><a href="#cb17-12"></a></span>
<span id="cb17-13"><a href="#cb17-13"></a><span class="co"># samples</span></span>
<span id="cb17-14"><a href="#cb17-14"></a>df3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">as.vector</span>(samp.all),</span>
<span id="cb17-15"><a href="#cb17-15"></a>              <span class="at">y =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>nexp <span class="sc">+</span> <span class="fl">0.15</span>, n)</span>
<span id="cb17-16"><a href="#cb17-16"></a>)</span>
<span id="cb17-17"><a href="#cb17-17"></a></span>
<span id="cb17-18"><a href="#cb17-18"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb17-19"><a href="#cb17-19"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> gr, <span class="at">colour =</span> inout), <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">lineend =</span> <span class="st">"round"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="co"># CI</span></span>
<span id="cb17-20"><a href="#cb17-20"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df3, <span class="at">size=</span><span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> <span class="co"># samples</span></span>
<span id="cb17-21"><a href="#cb17-21"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df2, <span class="fu">aes</span>(<span class="at">colour =</span> inout), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="co"># sample means</span></span>
<span id="cb17-22"><a href="#cb17-22"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkgrey"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb17-23"><a href="#cb17-23"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> logpop.m, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb17-24"><a href="#cb17-24"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Values"</span>, <span class="at">y =</span> <span class="st">"Experiments"</span>) <span class="sc">+</span></span>
<span id="cb17-25"><a href="#cb17-25"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb17-26"><a href="#cb17-26"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb17-27"><a href="#cb17-27"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">minor_breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="02-07-gar-ci_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># ggsave(filename = './figures/nb2_20expt_ttci_lnorm.pdf', width = 5, height = 7)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="illustrate-results-bootstrap" class="level4" data-number="6.6.1.2"><h4 data-number="6.6.1.2" class="anchored" data-anchor-id="illustrate-results-bootstrap">
<span class="header-section-number">6.6.1.2</span> Illustrate results: bootstrap</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># re-use the previous chunk if you want to see how the results look like for the percentile bootstrap confidence intervals.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="experiments---20000-confidence-intervals-1" class="level3" data-number="6.6.2"><h3 data-number="6.6.2" class="anchored" data-anchor-id="experiments---20000-confidence-intervals-1">
<span class="header-section-number">6.6.2</span> 20,000 experiments - 20,000 confidence intervals</h3>
<p>Now we do 20,000 experiments, and check the long term coverage of the confidence intervals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">set.seed</span>(<span class="dv">21</span>) <span class="co"># set seed of random number generator</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>alpha.val <span class="ot">&lt;-</span> .<span class="dv">1</span> <span class="co"># 90% confidence interval</span></span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a>nexp <span class="ot">&lt;-</span> <span class="dv">20000</span> <span class="co"># number of experiments</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span> <span class="co"># sample size in each experiment</span></span>
<span id="cb20-6"><a href="#cb20-6"></a></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="co">#declare matrices to save results</span></span>
<span id="cb20-8"><a href="#cb20-8"></a>ci.ttest <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> nexp, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb20-9"><a href="#cb20-9"></a>ci.ttest.in <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> nexp)</span>
<span id="cb20-10"><a href="#cb20-10"></a>mean.all <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> nexp)</span>
<span id="cb20-11"><a href="#cb20-11"></a></span>
<span id="cb20-12"><a href="#cb20-12"></a><span class="cf">for</span>(E <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nexp){</span>
<span id="cb20-13"><a href="#cb20-13"></a>  <span class="co"># sample data </span></span>
<span id="cb20-14"><a href="#cb20-14"></a>  samp <span class="ot">&lt;-</span> <span class="fu">rlnorm</span>(n, pop.m, pop.sd)</span>
<span id="cb20-15"><a href="#cb20-15"></a>  <span class="co"># mean.all[E] &lt;- mean(samp) # sample means</span></span>
<span id="cb20-16"><a href="#cb20-16"></a>  ci.ttest[E,] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(samp, <span class="at">conf.level =</span> <span class="dv">1</span><span class="sc">-</span>alpha.val)<span class="sc">$</span>conf.int</span>
<span id="cb20-17"><a href="#cb20-17"></a>  <span class="co"># check if the confidence interval includes the population value</span></span>
<span id="cb20-18"><a href="#cb20-18"></a>  <span class="cf">if</span>(ci.ttest[E,<span class="dv">1</span>] <span class="sc">&gt;</span> logpop.m <span class="sc">||</span> ci.ttest[E,<span class="dv">2</span>] <span class="sc">&lt;</span> logpop.m){</span>
<span id="cb20-19"><a href="#cb20-19"></a>    ci.ttest.in[E] <span class="ot">&lt;-</span> <span class="dv">0</span>  </span>
<span id="cb20-20"><a href="#cb20-20"></a>  } <span class="cf">else</span>{</span>
<span id="cb20-21"><a href="#cb20-21"></a>    ci.ttest.in[E] <span class="ot">&lt;-</span> <span class="dv">1</span>  </span>
<span id="cb20-22"><a href="#cb20-22"></a>  }</span>
<span id="cb20-23"><a href="#cb20-23"></a>  </span>
<span id="cb20-24"><a href="#cb20-24"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Confidence interval coverage = 81.9%.</p>
<section id="illustrate-cis-excluding-population-1" class="level4" data-number="6.6.2.1"><h4 data-number="6.6.2.1" class="anchored" data-anchor-id="illustrate-cis-excluding-population-1">
<span class="header-section-number">6.6.2.1</span> Illustrate CIs excluding population</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>ci <span class="ot">&lt;-</span> ci.ttest[ci.ttest.in<span class="sc">==</span><span class="dv">0</span>, ]</span>
<span id="cb21-2"><a href="#cb21-2"></a>todo <span class="ot">&lt;-</span> <span class="fu">sum</span>(ci.ttest.in<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb21-3"><a href="#cb21-3"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">as.vector</span>(ci),</span>
<span id="cb21-4"><a href="#cb21-4"></a>             <span class="at">y =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>todo, <span class="dv">2</span>),</span>
<span id="cb21-5"><a href="#cb21-5"></a>             <span class="at">gr =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>todo,<span class="dv">2</span>))</span>
<span id="cb21-6"><a href="#cb21-6"></a>)</span>
<span id="cb21-7"><a href="#cb21-7"></a></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb21-9"><a href="#cb21-9"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> gr)) <span class="sc">+</span></span>
<span id="cb21-10"><a href="#cb21-10"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> logpop.m, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Bounds"</span>, <span class="at">y =</span> <span class="st">"Confidence intervals"</span>) <span class="sc">+</span> </span>
<span id="cb21-12"><a href="#cb21-12"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb21-13"><a href="#cb21-13"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="02-07-gar-ci_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># ggsave(filename = './figures/nb2_ttci_norm_expop.pdf')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Proportion of confidence intervals shifted to the <strong>left</strong> of the population value = 17.4%.</p>
<p>Proportion of confidence intervals shifted to the <strong>right</strong> of the population value = 0.7%.</p>
</section></section></section><section id="confidence-interval-coverage-simulation-mean-and-20-trimmed-mean" class="level2" data-number="6.7"><h2 data-number="6.7" class="anchored" data-anchor-id="confidence-interval-coverage-simulation-mean-and-20-trimmed-mean">
<span class="header-section-number">6.7</span> Confidence interval coverage simulation: mean and 20% trimmed mean</h2>
<p>Here is another example of a simple simulation to check the probability coverage of a confidence interval method. The simulation has 10,000 iterations, which is often recommended or expected in the literature. For more complex applications, time might be a constraint.</p>
<p>The sample size is 30, which seems reasonably high for a psychology experiment. A more systematic simulation should include sample size as a parameter.</p>
<p>The populations are normal and lognormal and are generated outside the simulation loop. An alternative is to generate the random numbers directly inside the loop by using <code>samp &lt;- rlnorm(nsamp)</code> and <code>samp &lt;- rnorm(nsamp)</code>. The lognormal distribution is one of many skewed mathematical distributions. It serves to illustrate what can happen when sampling from skewed distributions in general. Other shapes could be used to, if some domain specific information is available. For instance, ex-Gaussian and shifted log-normal distributions do a good job at capturing the shape of reaction time distributions.</p>
<section id="illustrate-populations" class="level3" data-number="6.7.1"><h3 data-number="6.7.1" class="anchored" data-anchor-id="illustrate-populations">
<span class="header-section-number">6.7.1</span> Illustrate populations</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">15</span>, <span class="fl">0.01</span>)</span>
<span id="cb23-2"><a href="#cb23-2"></a>nx <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb23-3"><a href="#cb23-3"></a>dn <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(x, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb23-4"><a href="#cb23-4"></a>dl <span class="ot">&lt;-</span> <span class="fu">dlnorm</span>(x, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb23-5"><a href="#cb23-5"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rep</span>(x, <span class="dv">2</span>), </span>
<span id="cb23-6"><a href="#cb23-6"></a>             <span class="at">y =</span> <span class="fu">c</span>(dl, dn), </span>
<span id="cb23-7"><a href="#cb23-7"></a>             <span class="at">distribution =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Lognormal"</span>, <span class="st">"Normal"</span>), <span class="at">each =</span> nx)))</span>
<span id="cb23-8"><a href="#cb23-8"></a></span>
<span id="cb23-9"><a href="#cb23-9"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">colour =</span> distribution)) <span class="sc">+</span> theme_gar <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>)  <span class="sc">+</span></span>
<span id="cb23-11"><a href="#cb23-11"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb23-12"><a href="#cb23-12"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.8</span>),</span>
<span id="cb23-13"><a href="#cb23-13"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-14"><a href="#cb23-14"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb23-15"><a href="#cb23-15"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Values"</span>, </span>
<span id="cb23-16"><a href="#cb23-16"></a>       <span class="at">y =</span> <span class="st">"Density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="02-07-gar-ci_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># save figure</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="co"># ggsave(filename = "norm_lnorm_pop.pdf", width = 15, height = 10, units = "cm")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The population means and trimmed means differ and are estimated independently in the simulation: the sample mean is used to make inferences about the population mean, whereas the sample trimmed mean is used to make inferences about the population trimmed mean.</p>
</section><section id="trimmed-means" class="level3" data-number="6.7.2"><h3 data-number="6.7.2" class="anchored" data-anchor-id="trimmed-means">
<span class="header-section-number">6.7.2</span> Trimmed means</h3>
<section id="illustrate-20-trimming---normal-distribution" class="level4" data-number="6.7.2.1"><h4 data-number="6.7.2.1" class="anchored" data-anchor-id="illustrate-20-trimming---normal-distribution">
<span class="header-section-number">6.7.2.1</span> Illustrate 20% trimming - Normal distribution</h4>
<p>For variety, the example below uses base R graphics to display a normal distribution with each blue area marking 20% of the distribution density (area under the curve). If your head hurts trying to understand the calls to the <code>polygon</code> function, don’t worry, it took me many trials and errors until I could produce this figure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>tr <span class="ot">&lt;-</span> .<span class="dv">25</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>xv <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">0.01</span>)</span>
<span id="cb25-3"><a href="#cb25-3"></a>yv <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(xv)</span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="fu">plot</span>(xv,yv,<span class="at">type=</span><span class="st">"l"</span>)</span>
<span id="cb25-5"><a href="#cb25-5"></a>zval <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(tr, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>, <span class="at">lower.tail =</span> <span class="cn">TRUE</span>, <span class="at">log.p =</span> <span class="cn">FALSE</span>)</span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="fu">polygon</span>(<span class="fu">c</span>(xv[xv<span class="sc">&lt;=</span>zval],zval),<span class="fu">c</span>(yv[xv<span class="sc">&lt;=</span>zval],yv[xv<span class="sc">==-</span><span class="dv">4</span>]),<span class="at">col=</span><span class="dv">5</span>)</span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="fu">polygon</span>(<span class="fu">c</span>(xv[xv<span class="sc">&gt;=-</span>zval],<span class="sc">-</span>zval),<span class="fu">c</span>(yv[xv<span class="sc">&gt;=-</span>zval],yv[xv<span class="sc">==</span><span class="dv">4</span>]),<span class="at">col=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="02-07-gar-ci_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="illustrate-20-trimming---f-distribution" class="level4" data-number="6.7.2.2"><h4 data-number="6.7.2.2" class="anchored" data-anchor-id="illustrate-20-trimming---f-distribution">
<span class="header-section-number">6.7.2.2</span> Illustrate 20% trimming - F distribution</h4>
<p>Why an F distribution? No particular reason, it is one of many skewed distributions we could choose from.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>tr <span class="ot">&lt;-</span> .<span class="dv">2</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>xv <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>,<span class="dv">4</span>,<span class="fl">0.01</span>)</span>
<span id="cb26-3"><a href="#cb26-3"></a>yv <span class="ot">&lt;-</span> <span class="fu">df</span>(xv,<span class="dv">6</span>,<span class="dv">18</span>) <span class="co">#fx&lt;-dlnorm(x)</span></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="fu">plot</span>(xv,yv,<span class="at">type=</span><span class="st">"l"</span>)</span>
<span id="cb26-5"><a href="#cb26-5"></a>zval <span class="ot">&lt;-</span> <span class="fu">qf</span>(tr,<span class="dv">6</span>,<span class="dv">18</span>)</span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="fu">polygon</span>(<span class="fu">c</span>(xv[xv<span class="sc">&lt;=</span>zval],zval),<span class="fu">c</span>(yv[xv<span class="sc">&lt;=</span>zval],yv[xv<span class="sc">==</span><span class="fl">0.01</span>]),<span class="at">col=</span><span class="dv">5</span>)</span>
<span id="cb26-7"><a href="#cb26-7"></a>zval <span class="ot">&lt;-</span> <span class="fu">qf</span>(<span class="dv">1</span><span class="sc">-</span>tr,<span class="dv">6</span>,<span class="dv">18</span>)</span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="fu">polygon</span>(<span class="fu">c</span>(xv[xv<span class="sc">&gt;=</span>zval],zval),<span class="fu">c</span>(yv[xv<span class="sc">&gt;=</span>zval],yv[xv<span class="sc">==</span><span class="dv">4</span>]),<span class="at">col=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="02-07-gar-ci_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section></section><section id="simulation" class="level2" data-number="6.8"><h2 data-number="6.8" class="anchored" data-anchor-id="simulation">
<span class="header-section-number">6.8</span> Simulation</h2>
<p><strong>DO NOT RUN THE NEXT CHUNK UNLESS YOU’RE PLANNING A BREAK!</strong></p>
<p>If you want to try the code, and potentially look at other quantities and methods, you can speed things up by reducing <code>nsim</code> and <code>nboot</code>.</p>
<p>To make inferences about 20% trimmed means, we use a t-test in which the standard error was adjusted to take into account the trimming, as implemented in the <code>trimci</code> function. We also use the more straightforward percentile bootstrap, which doesn’t make parametric assumption and doesn’t involve standard error estimation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">set.seed</span>(<span class="dv">666</span>) <span class="co"># reproducible results</span></span>
<span id="cb27-2"><a href="#cb27-2"></a></span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="co"># Define parameters</span></span>
<span id="cb27-4"><a href="#cb27-4"></a>nsim <span class="ot">&lt;-</span> <span class="dv">10000</span> <span class="co"># simulation iterations </span></span>
<span id="cb27-5"><a href="#cb27-5"></a>nsamp <span class="ot">&lt;-</span> <span class="dv">30</span> <span class="co"># sample size</span></span>
<span id="cb27-6"><a href="#cb27-6"></a>nboot <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co"># could/should use more</span></span>
<span id="cb27-7"><a href="#cb27-7"></a>tp <span class="ot">&lt;-</span> <span class="fl">0.2</span> <span class="co"># percentage of trimming</span></span>
<span id="cb27-8"><a href="#cb27-8"></a>alpha.val <span class="ot">&lt;-</span> .<span class="dv">05</span> <span class="co"># 1-alpha = 95% confidence interval</span></span>
<span id="cb27-9"><a href="#cb27-9"></a></span>
<span id="cb27-10"><a href="#cb27-10"></a><span class="co"># define populations</span></span>
<span id="cb27-11"><a href="#cb27-11"></a>pop1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1000000</span>) </span>
<span id="cb27-12"><a href="#cb27-12"></a>pop2 <span class="ot">&lt;-</span> <span class="fu">rlnorm</span>(<span class="dv">1000000</span>) </span>
<span id="cb27-13"><a href="#cb27-13"></a><span class="co"># population means</span></span>
<span id="cb27-14"><a href="#cb27-14"></a>pop1.m <span class="ot">&lt;-</span> <span class="fu">mean</span>(pop1) </span>
<span id="cb27-15"><a href="#cb27-15"></a>pop2.m <span class="ot">&lt;-</span> <span class="fu">mean</span>(pop2) </span>
<span id="cb27-16"><a href="#cb27-16"></a><span class="co"># population 20% trimmed means</span></span>
<span id="cb27-17"><a href="#cb27-17"></a>pop1.tm <span class="ot">&lt;-</span> <span class="fu">mean</span>(pop1, <span class="at">trim =</span> <span class="fl">0.2</span>) </span>
<span id="cb27-18"><a href="#cb27-18"></a>pop2.tm <span class="ot">&lt;-</span> <span class="fu">mean</span>(pop2, <span class="at">trim =</span> <span class="fl">0.2</span>) </span>
<span id="cb27-19"><a href="#cb27-19"></a></span>
<span id="cb27-20"><a href="#cb27-20"></a><span class="co"># declare matrices of results</span></span>
<span id="cb27-21"><a href="#cb27-21"></a>ci.cov.norm <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="co"># coverage for normal population</span></span>
<span id="cb27-22"><a href="#cb27-22"></a>ci.cov.lnorm <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nsim, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="co"># coverage for lognormal population</span></span>
<span id="cb27-23"><a href="#cb27-23"></a></span>
<span id="cb27-24"><a href="#cb27-24"></a><span class="cf">for</span>(S <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim){ <span class="co"># simulation loop</span></span>
<span id="cb27-25"><a href="#cb27-25"></a>  </span>
<span id="cb27-26"><a href="#cb27-26"></a>  <span class="cf">if</span>(S <span class="sc">==</span> <span class="dv">1</span>){ <span class="co"># iteration message to print in the console</span></span>
<span id="cb27-27"><a href="#cb27-27"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"iteration"</span>,S,<span class="st">"/"</span>,nsim))</span>
<span id="cb27-28"><a href="#cb27-28"></a>    <span class="fu">beep</span>(<span class="dv">2</span>)</span>
<span id="cb27-29"><a href="#cb27-29"></a>  }</span>
<span id="cb27-30"><a href="#cb27-30"></a>  <span class="cf">if</span>(S <span class="sc">%%</span> <span class="dv">1000</span> <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb27-31"><a href="#cb27-31"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"iteration"</span>,S,<span class="st">"/"</span>,nsim))</span>
<span id="cb27-32"><a href="#cb27-32"></a>    <span class="fu">beep</span>(<span class="dv">2</span>)</span>
<span id="cb27-33"><a href="#cb27-33"></a>  }</span>
<span id="cb27-34"><a href="#cb27-34"></a>  </span>
<span id="cb27-35"><a href="#cb27-35"></a>  <span class="co"># Normal population =======================</span></span>
<span id="cb27-36"><a href="#cb27-36"></a>  samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(pop1, nsamp, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="co"># random sample from population</span></span>
<span id="cb27-37"><a href="#cb27-37"></a>  <span class="co"># Mean + t-test</span></span>
<span id="cb27-38"><a href="#cb27-38"></a>  ci <span class="ot">&lt;-</span> <span class="fu">t.test</span>(samp, <span class="at">mu =</span> pop1.m, <span class="at">conf.level =</span> <span class="dv">1</span><span class="sc">-</span>alpha.val)<span class="sc">$</span>conf.int <span class="co"># standard t-test equation</span></span>
<span id="cb27-39"><a href="#cb27-39"></a>  ci.cov.norm[S,<span class="dv">1</span>] <span class="ot">&lt;-</span> ci[<span class="dv">1</span>]<span class="sc">&lt;</span>pop1.m <span class="sc">&amp;&amp;</span> ci[<span class="dv">2</span>]<span class="sc">&gt;</span>pop1.m <span class="co"># CI includes population value?</span></span>
<span id="cb27-40"><a href="#cb27-40"></a>  <span class="co"># 20% trimmed mean + adjusted t-test</span></span>
<span id="cb27-41"><a href="#cb27-41"></a>  ci <span class="ot">&lt;-</span> <span class="fu">trimci</span>(samp, <span class="at">tr =</span> tp, <span class="at">pr =</span> <span class="cn">FALSE</span>, <span class="at">alpha =</span> alpha.val)<span class="sc">$</span>ci <span class="co"># get adjusted t-test confidence interval</span></span>
<span id="cb27-42"><a href="#cb27-42"></a>  ci.cov.norm[S,<span class="dv">2</span>] <span class="ot">&lt;-</span> ci[<span class="dv">1</span>]<span class="sc">&lt;</span>pop1.tm <span class="sc">&amp;&amp;</span> ci[<span class="dv">2</span>]<span class="sc">&gt;</span>pop1.tm <span class="co"># CI includes population value?</span></span>
<span id="cb27-43"><a href="#cb27-43"></a>  <span class="co"># 20% trimmed mean + percentile bootstrap</span></span>
<span id="cb27-44"><a href="#cb27-44"></a>  ci <span class="ot">&lt;-</span> <span class="fu">onesampb</span>(samp, <span class="at">est=</span>mean, <span class="at">nboot=</span>nboot, <span class="at">trim=</span>tp, <span class="at">alpha=</span>alpha.val)<span class="sc">$</span>ci <span class="co"># get bootstrap confidence interval</span></span>
<span id="cb27-45"><a href="#cb27-45"></a>  ci.cov.norm[S,<span class="dv">3</span>] <span class="ot">&lt;-</span> ci[<span class="dv">1</span>]<span class="sc">&lt;</span>pop1.tm <span class="sc">&amp;&amp;</span> ci[<span class="dv">2</span>]<span class="sc">&gt;</span>pop1.tm <span class="co"># CI includes population value?</span></span>
<span id="cb27-46"><a href="#cb27-46"></a>  </span>
<span id="cb27-47"><a href="#cb27-47"></a>  <span class="co"># Log-normal population =======================</span></span>
<span id="cb27-48"><a href="#cb27-48"></a>  samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(pop2, nsamp, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="co"># random sample from population</span></span>
<span id="cb27-49"><a href="#cb27-49"></a>  <span class="co"># Mean + t-test</span></span>
<span id="cb27-50"><a href="#cb27-50"></a>  ci <span class="ot">&lt;-</span> <span class="fu">t.test</span>(samp, <span class="at">mu =</span> pop2.m, <span class="at">conf.level =</span> <span class="dv">1</span><span class="sc">-</span>alpha.val)<span class="sc">$</span>conf.int <span class="co"># standard t-test equation</span></span>
<span id="cb27-51"><a href="#cb27-51"></a>  ci.cov.lnorm[S,<span class="dv">1</span>] <span class="ot">&lt;-</span> ci[<span class="dv">1</span>]<span class="sc">&lt;</span>pop2.m <span class="sc">&amp;&amp;</span> ci[<span class="dv">2</span>]<span class="sc">&gt;</span>pop2.m <span class="co"># CI includes population value?</span></span>
<span id="cb27-52"><a href="#cb27-52"></a>  <span class="co"># 20% trimmed mean + adjusted t-test</span></span>
<span id="cb27-53"><a href="#cb27-53"></a>  ci <span class="ot">&lt;-</span> <span class="fu">trimci</span>(samp, <span class="at">tr =</span> tp, <span class="at">pr =</span> <span class="cn">FALSE</span>, <span class="at">alpha =</span> alpha.val)<span class="sc">$</span>ci <span class="co"># get adjusted t-test confidence interval</span></span>
<span id="cb27-54"><a href="#cb27-54"></a>  ci.cov.lnorm[S,<span class="dv">2</span>] <span class="ot">&lt;-</span> ci[<span class="dv">1</span>]<span class="sc">&lt;</span>pop2.tm <span class="sc">&amp;&amp;</span> ci[<span class="dv">2</span>]<span class="sc">&gt;</span>pop2.tm <span class="co"># CI includes population value?</span></span>
<span id="cb27-55"><a href="#cb27-55"></a>  <span class="co"># 20% trimmed mean + percentile bootstrap</span></span>
<span id="cb27-56"><a href="#cb27-56"></a>  ci <span class="ot">&lt;-</span> <span class="fu">onesampb</span>(samp, <span class="at">est=</span>mean, <span class="at">nboot=</span>nboot, <span class="at">trim=</span>tp, <span class="at">alpha=</span>alpha.val)<span class="sc">$</span>ci <span class="co"># get bootstrap confidence interval</span></span>
<span id="cb27-57"><a href="#cb27-57"></a>  ci.cov.lnorm[S,<span class="dv">3</span>] <span class="ot">&lt;-</span> ci[<span class="dv">1</span>]<span class="sc">&lt;</span>pop2.tm <span class="sc">&amp;&amp;</span> ci[<span class="dv">2</span>]<span class="sc">&gt;</span>pop2.tm <span class="co"># CI includes population value?</span></span>
<span id="cb27-58"><a href="#cb27-58"></a>}</span>
<span id="cb27-59"><a href="#cb27-59"></a></span>
<span id="cb27-60"><a href="#cb27-60"></a><span class="fu">apply</span>(ci.cov.norm, <span class="dv">2</span>, mean) <span class="co"># average across simulations for each method</span></span>
<span id="cb27-61"><a href="#cb27-61"></a><span class="fu">apply</span>(ci.cov.lnorm, <span class="dv">2</span>, mean) <span class="co"># average across simulations for each method</span></span>
<span id="cb27-62"><a href="#cb27-62"></a></span>
<span id="cb27-63"><a href="#cb27-63"></a><span class="co"># save simulation results to load in next chunk</span></span>
<span id="cb27-64"><a href="#cb27-64"></a><span class="fu">save</span>(ci.cov.norm, ci.cov.lnorm, <span class="at">file =</span> <span class="st">"data/ci.coverage.RData"</span>)</span>
<span id="cb27-65"><a href="#cb27-65"></a></span>
<span id="cb27-66"><a href="#cb27-66"></a><span class="fu">beep</span>(<span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here are the results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="fu">load</span>(<span class="st">"data/ci.coverage.RData"</span>)</span>
<span id="cb28-2"><a href="#cb28-2"></a></span>
<span id="cb28-3"><a href="#cb28-3"></a>res.norm <span class="ot">&lt;-</span> <span class="fu">apply</span>(ci.cov.norm, <span class="dv">2</span>, mean) <span class="co"># average across simulations</span></span>
<span id="cb28-4"><a href="#cb28-4"></a></span>
<span id="cb28-5"><a href="#cb28-5"></a>res.lnorm <span class="ot">&lt;-</span> <span class="fu">apply</span>(ci.cov.lnorm, <span class="dv">2</span>, mean) <span class="co"># average across simulations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Coverage when sampling from the normal population:</p>
<ul>
<li><p>t-test + mean = 95%</p></li>
<li><p>adjusted t-test + 20% trimmed mean = 94.5%</p></li>
<li><p>percentile bootstrap + 20% trimmed mean = 94.5%</p></li>
</ul>
<p>Coverage when sampling from the lognormal population:</p>
<ul>
<li><p>t-test + mean = 88.3%</p></li>
<li><p>adjusted t-test + 20% trimmed mean = 93%<br></p></li>
<li><p>percentile bootstrap + 20% trimmed mean = 94.5%</p></li>
</ul>
<p>These results demonstrate that when sampling from a skewed distribution such as the lognormal distribution, coverage can be very different from the expected one (here we expected 95% coverage).</p>
<p>Question: What happens when we make inferences about the 20% trimmed mean?</p>


</section></main><!-- /main --><script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script><script>
// open rdrr links externally ----

var exlinks = document.querySelectorAll("a[href^='https://rdrr.io']");
var exlink_func = function(){
  window.open(this.href);
  return false;
};
for (var i = 0; i < exlinks.length; i++) {
    exlinks[i].addEventListener('click', exlink_func, false);
}

// visible second sidebar in mobile ----

function move_sidebar() {
  var toc = document.getElementById("TOC");
  var small_sidebar = document.querySelector("#quarto-sidebar .sidebar-menu-container");
  var right_sidebar = document.getElementById("quarto-margin-sidebar");

  if (window.innerWidth < 768) {
    small_sidebar.append(toc);
  } else {
    right_sidebar.append(toc);
  }
}
move_sidebar();
window.onresize = move_sidebar;
</script><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./02-00-graph_robust.html" class="pagination-link" aria-label="Graphical representations and robust statistics">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Graphical representations and robust statistics</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./02-08-gar-gpcomp.html" class="pagination-link" aria-label="Perspectives on group comparisons">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Perspectives on group comparisons</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>CC-BY (2025) Bartlett, Rousselet, &amp; DeBruine.</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


</body></html>